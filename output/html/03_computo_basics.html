<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ComputoPermuto Book - 03_computo_basics</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">ComputoPermuto Book - 03_computo_basics</h1>
</header>
<h2 id="chapter-3-computo-basics---data-and-logic"><strong>Chapter 3:
Computo Basics - Data and Logic</strong></h2>
<p>Now that you have a working environment, it’s time to start
transforming JSON. In this chapter, we’ll focus on the core of Computo:
its syntax, its fundamental operators, and how it handles data.</p>
<p>At its heart, Computo treats <strong>code as data</strong>. Every
Computo script is itself a valid JSON document. This is a powerful
concept borrowed from Lisp-like languages that makes scripts easy to
generate, store, and even manipulate programmatically.</p>
<h3 id="the-anatomy-of-a-computo-expression">The Anatomy of a Computo
Expression</h3>
<p>An “operation” in Computo is represented by a JSON array where the
first element is a string identifying the operator.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;+&quot;</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">]</span></span></code></pre></div>
<p>This is a Computo expression that instructs the engine to use the
<code>+</code> operator on the numbers <code>10</code> and
<code>5</code>. If you were to run this script, the engine would
evaluate it and return the JSON number <code>15</code>.</p>
<p>Any JSON that isn’t an operator call is treated as a <strong>literal
value</strong>.</p>
<ul>
<li><code>42</code> evaluates to the number <code>42</code>.</li>
<li><code>"hello"</code> evaluates to the string
<code>"hello"</code>.</li>
<li><code>{"name": "Alice"}</code> evaluates to a JSON object.</li>
</ul>
<p>The magic happens when you start nesting these expressions.</p>
<h3 id="your-first-transformation-simple-arithmetic">Your First
Transformation: Simple Arithmetic</h3>
<p>Let’s start with the simplest possible script.</p>
<ol type="1">
<li><p>Create a file named <code>add.json</code>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;+&quot;</span><span class="ot">,</span> <span class="dv">100</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">]</span></span></code></pre></div></li>
<li><p>Create an empty file for our input, <code>input.json</code>:
<em>(Computo requires an input file, even if the script doesn’t use it
yet.)</em></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{}</span></span></code></pre></div></li>
<li><p>Now, run it from your terminal:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> add.json input.json</span></code></pre></div></li>
</ol>
<p>The output will be:</p>
<pre><code>150</code></pre>
<p>By default, Computo outputs JSON in compact form. For development and
learning, you might prefer pretty-printed output:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> <span class="at">--pretty</span><span class="op">=</span>2 add.json input.json</span></code></pre></div>
<p>This produces the same result but with proper indentation when
dealing with complex structures.</p>
<h3 id="understanding-output-formatting">Understanding Output
Formatting</h3>
<p>The <code>--pretty=N</code> option controls how Computo formats its
JSON output:</p>
<ul>
<li><strong>No flag (default)</strong>: Compact output -
<code>{"name":"Alice","age":30}</code></li>
<li><strong><code>--pretty=2</code></strong>: Pretty-printed with
2-space indentation</li>
<li><strong><code>--pretty=4</code></strong>: Pretty-printed with
4-space indentation</li>
</ul>
<p>For learning and development, we recommend using
<code>--pretty=2</code> to make complex JSON structures easier to read.
In production scripts or pipelines, you might prefer the compact default
format for efficiency.</p>
<h3 id="adding-comments-to-scripts-cli-only">Adding Comments to Scripts
(CLI Only)</h3>
<p>When working with complex transformations, you might want to add
comments to your script files for documentation. The CLI tool supports
this with the <code>--comments</code> flag:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable comment parsing in script files</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> <span class="at">--comments</span> <span class="at">--pretty</span><span class="op">=</span>2 script_with_comments.json input.json</span></code></pre></div>
<p><strong>Important</strong>: Comments are only supported in
<strong>script files</strong>, not input files, and only when using the
CLI tool (not the C++ library API).</p>
<p>Example commented script:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">//</span> <span class="er">This</span> <span class="er">creates</span> <span class="er">a</span> <span class="er">user</span> <span class="er">profile</span> <span class="er">object</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;obj&quot;</span><span class="ot">,</span> <span class="er">//</span> <span class="er">obj</span> <span class="er">creates</span> <span class="er">a</span> <span class="er">JSON</span> <span class="er">object</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">/*</span> <span class="er">Extract</span> <span class="er">the</span> <span class="er">user&#39;s</span> <span class="er">name</span> <span class="er">from</span> <span class="er">input</span> <span class="er">data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="er">and</span> <span class="er">format</span> <span class="er">it</span> <span class="er">for</span> <span class="er">display</span> <span class="er">*/</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/name&quot;</span><span class="ot">]],</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;greeting&quot;</span><span class="ot">,</span> <span class="st">&quot;Welcome!&quot;</span><span class="ot">]</span> <span class="er">//</span> <span class="er">Static</span> <span class="er">greeting</span> <span class="er">message</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>Supported comment styles: - <code>// Single line comments</code> -
<code>/* Multi-line comments */</code></p>
<p>The Computo engine evaluated the expression and printed the resulting
JSON to your console. Now let’s try nesting. Change
<code>add.json</code> to:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;+&quot;</span><span class="ot">,</span> <span class="dv">100</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;*&quot;</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">]]</span></span></code></pre></div>
<p>Run it again. The output is <code>150</code>. The engine first
evaluated the inner expression <code>["*", 5, 10]</code> to get
<code>50</code>, then evaluated the outer expression
<code>["+", 100, 50]</code>.</p>
<h3 id="creating-objects-and-arrays">Creating Objects and Arrays</h3>
<p>After experimenting with basic arithmetic, you might wonder how to
create more complex JSON structures. Computo provides specific syntax
for constructing objects and arrays.</p>
<h4 id="creating-objects-with-obj">Creating Objects with
<code>obj</code></h4>
<p>To create a JSON object, use the <code>obj</code> operator with
key-value pairs:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;key1&quot;</span><span class="ot">,</span> <span class="st">&quot;value1&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;key2&quot;</span><span class="ot">,</span> <span class="st">&quot;value2&quot;</span><span class="ot">]]</span></span></code></pre></div>
<p>Let’s try this. Create a script called
<code>make_object.json</code>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="st">&quot;Alice&quot;</span><span class="ot">],</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;age&quot;</span><span class="ot">,</span> <span class="dv">30</span><span class="ot">],</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;score&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;+&quot;</span><span class="ot">,</span> <span class="dv">85</span><span class="ot">,</span> <span class="dv">15</span><span class="ot">]]</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>Run it:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> <span class="at">--pretty</span><span class="op">=</span>2 make_object.json input.json</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Alice&quot;</span><span class="fu">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;age&quot;</span><span class="fu">:</span> <span class="dv">30</span><span class="fu">,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;score&quot;</span><span class="fu">:</span> <span class="dv">100</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Note: We’re using <code>--pretty=2</code> to format the output with
2-space indentation for readability. Without this flag, the output would
be compact: <code>{"name":"Alice","age":30,"score":100}</code></p>
<p>Notice how the <code>score</code> value is computed from the nested
arithmetic expression <code>["+", 85, 15]</code>.</p>
<h4 id="creating-arrays">Creating Arrays</h4>
<p>For arrays, use the special <code>{"array": [...]}</code> syntax:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;array&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;*&quot;</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">]]</span><span class="fu">}</span></span></code></pre></div>
<p>Create a script called <code>make_array.json</code>:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;array&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hello&quot;</span><span class="ot">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">42</span><span class="ot">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;+&quot;</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">],</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;type&quot;</span><span class="ot">,</span> <span class="st">&quot;computed&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;value&quot;</span><span class="ot">,</span> <span class="kw">true</span><span class="ot">]]</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span><span class="fu">}</span></span></code></pre></div>
<p>Run it:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> <span class="at">--pretty</span><span class="op">=</span>2 make_array.json input.json</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hello&quot;</span><span class="ot">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">42</span><span class="ot">,</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">15</span><span class="ot">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;computed&quot;</span><span class="fu">,</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;value&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This array contains: - A literal string <code>"hello"</code> - A
literal number <code>42</code> - A computed number <code>15</code> from
<code>["+", 10, 5]</code> - A computed object from the <code>obj</code>
operator</p>
<h3 id="a-note-on-syntax-why-array-..."><strong>A Note on Syntax: Why
<code>{"array": [...]}</code>?</strong></h3>
<p>You may wonder why literal arrays are written as
<code>{"array": [...]}</code> instead of a simpler
<code>["arr", ...]</code> operator. This was a deliberate design choice
for one critical reason: <strong>to eliminate ambiguity</strong>.</p>
<p>In Computo, a JSON array like <code>["operator", ...]</code> is
always an action. But what about a simple array of strings, like
<code>["red", "green", "blue"]</code>? Without a special rule, the
interpreter would see <code>"red"</code> and think it’s an invalid
operator.</p>
<p>The <code>{"array": [...]}</code> syntax provides a clear,
unambiguous signal to the interpreter: “Treat this as a literal piece of
data, not an action to perform.”</p>
<p>This allows the core rule—<strong>arrays are for actions, objects are
for data</strong>—to hold true, making the language robust and
predictable. It trades a small amount of verbosity for absolute
clarity.</p>
<p>Now that you know how to construct basic data structures, let’s learn
how to work with dynamic input data.</p>
<h3 id="accessing-input-data-with-input-and-get">Accessing Input Data
with <code>$input</code> and <code>get</code></h3>
<p>Static scripts are only so useful. The real power comes from
transforming dynamic input data. Computo makes the entire contents of
your <code>input.json</code> file available through a special,
zero-argument operator: <code>$input</code>. Please note that the name
of the operator has nothing to do with the filename.</p>
<p>Let’s create a more realistic scenario.</p>
<ol type="1">
<li><p>Update <code>input.json</code> with some user data:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;u-123&quot;</span><span class="fu">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Alice&quot;</span><span class="fu">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;plan&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;premium&quot;</span><span class="fu">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;monthly_cost&quot;</span><span class="fu">:</span> <span class="dv">20</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;last_login_ts&quot;</span><span class="fu">:</span> <span class="dv">1672531200</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
<li><p>Create a new script, <code>get_plan.json</code>, to extract the
plan name. To do this, we need another operator: <code>get</code>.</p>
<p><code>["get", &lt;object&gt;, &lt;json_pointer&gt;]</code></p>
<p>The <code>get</code> operator takes an object to query and a <a
href="https://datatracker.ietf.org/doc/html/rfc6901">JSON Pointer</a>
string to specify which value to extract.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/plan/name&quot;</span><span class="ot">]</span></span></code></pre></div></li>
<li><p>Run the script:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> get_plan.json input.json</span></code></pre></div></li>
</ol>
<p>The output will be:</p>
<pre><code>&quot;premium&quot;</code></pre>
<p>For simple values like strings, the <code>--pretty</code> flag
doesn’t make much difference, but it’s helpful for complex structures.
The engine first evaluated <code>["$input"]</code> to get the entire
input object, then <code>get</code> extracted the value at
<code>/user/plan/name</code>.</p>
<h3 id="storing-intermediate-values-with-let-and">Storing Intermediate
Values with <code>let</code> and <code>$</code></h3>
<p>Often, you need to calculate an intermediate value and reuse it
multiple times. Constantly re-evaluating long expressions like
<code>["get", ["$input"], "/user/plan"]</code> would be tedious and
inefficient.</p>
<p>Computo provides the <code>let</code> operator for binding values to
variables within a specific scope.</p>
<p><code>["let", [["var1", &lt;expr1&gt;], ...], &lt;body_expr&gt;]</code></p>
<p>Variables defined in a <code>let</code> block are accessed using the
<code>$</code> operator: <code>["$", "/var_name"]</code>. Note the
required <code>/</code> prefix, which makes variable access look similar
to root-level JSON Pointers.</p>
<p>Let’s build a new user object containing just the name and monthly
cost.</p>
<ol type="1">
<li><p>Create a script named <code>build_user.json</code>:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;let&quot;</span><span class="ot">,</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;user_plan&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/plan&quot;</span><span class="ot">]],</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;user_name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/name&quot;</span><span class="ot">]]</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/user_name&quot;</span><span class="ot">]],</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;cost&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/user_plan&quot;</span><span class="ot">],</span> <span class="st">&quot;/monthly_cost&quot;</span><span class="ot">]]</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div></li>
<li><p>Run the script with our previous <code>input.json</code>:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">computo</span> <span class="at">--pretty</span><span class="op">=</span>2 build_user.json input.json</span></code></pre></div></li>
</ol>
<p>The output is a completely new JSON object, built from pieces of the
input:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;cost&quot;</span><span class="fu">:</span> <span class="dv">20</span><span class="fu">,</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Alice&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Here’s the flow: 1. <code>let</code> creates a new scope. 2. It
evaluates <code>["get", ["$input"], "/user/plan"]</code> and binds the
resulting <code>{"name": "premium", "monthly_cost": 20}</code> object to
the variable <code>user_plan</code>. 3. It evaluates
<code>["get", ["$input"], "/user/name"]</code> and binds the string
<code>"Alice"</code> to the variable <code>user_name</code>. 4. It then
evaluates the body expression, substituting
<code>["$", "/user_name"]</code> with <code>"Alice"</code> and using
<code>get</code> on the <code>user_plan</code> object.</p>
<h3 id="in-this-chapter">In This Chapter</h3>
<p>You’ve learned the fundamental building blocks of Computo: * The
<strong>syntax</strong> of operators <code>["op", ...]</code> and
literal values. * How to <strong>create objects</strong> using the
<code>obj</code> operator with key-value pairs. * How to <strong>create
arrays</strong> using the <code>{"array": [...]}</code> syntax. * How to
<strong>format output</strong> using the <code>--pretty=N</code> CLI
option for readable JSON. * How to <strong>add comments</strong> to
script files using the <code>--comments</code> CLI flag. * How to access
the entire input document with <strong><code>$input</code></strong>. *
How to extract specific data with <strong><code>get</code></strong> and
JSON Pointers. * How to create temporary variables with
<strong><code>let</code></strong> and access them with
<strong><code>$</code></strong>.</p>
<p>These fundamental operators give you the power to construct new JSON
structures and perform data extraction and reshaping. In the next
chapter, we’ll switch gears and look at Permuto, the templating engine
that complements Computo’s logic.</p>
</body>
</html>
