<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ComputoPermuto Book - 12_performance_and_optimization</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">ComputoPermuto Book -
12_performance_and_optimization</h1>
</header>
<h2 id="chapter-12-performance-and-optimization"><strong>Chapter 12:
Performance and Optimization</strong></h2>
<p>You’ve now seen how to solve complex problems with Computo and
Permuto. As you move from writing small scripts to building
business-critical data pipelines, performance becomes an important
consideration.</p>
<p>The Computo engine is designed to be efficient, but the structure of
your script can have a significant impact on its execution speed and
memory usage. This chapter provides guidance on writing high-performance
transformations and understanding the trade-offs involved.</p>
<h3 id="the-golden-rule-let-is-your-best-friend">The Golden Rule:
<code>let</code> is Your Best Friend</h3>
<p>The single most important optimization technique in Computo is the
proper use of the <code>let</code> operator.</p>
<p><strong>Anti-Pattern: Re-evaluating Expressions</strong> Consider
this script that uses the same <code>get</code> expression multiple
times:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user&quot;</span><span class="ot">],</span> <span class="st">&quot;/profile&quot;</span><span class="ot">],</span> <span class="st">&quot;/name&quot;</span><span class="ot">]]</span><span class="er">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;email&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user&quot;</span><span class="ot">],</span> <span class="st">&quot;/profile&quot;</span><span class="ot">],</span> <span class="st">&quot;/email&quot;</span><span class="ot">]</span><span class="er">]</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="er">]</span></span></code></pre></div>
<p>The expression <code>["get", ["$input"], "/user"]</code> is evaluated
twice. While this is a small example, in a complex script with many
nested operators, this redundant work can add up.</p>
<p><strong>Optimized Pattern: Bind Once, Use Many Times</strong> By
binding the result of an expensive or frequently used expression to a
variable, you ensure it is evaluated only once.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;let&quot;</span><span class="ot">,</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;user_profile&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user&quot;</span><span class="ot">],</span> <span class="st">&quot;/profile&quot;</span><span class="ot">]]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/user_profile&quot;</span><span class="ot">],</span> <span class="st">&quot;/name&quot;</span><span class="ot">]],</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;email&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/user_profile&quot;</span><span class="ot">],</span> <span class="st">&quot;/email&quot;</span><span class="ot">]]</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This version is not only faster and more memory-efficient, but it’s
also significantly more readable. <strong>When in doubt, use
<code>let</code> to store the result of any non-trivial expression that
you plan to use more than once.</strong></p>
<h3 id="understanding-lazy-evaluation">Understanding Lazy
Evaluation</h3>
<p>Computo’s <code>if</code> operator is “lazy.” This means it only
evaluates the branch that is actually chosen. The other branch is never
touched. This has important performance implications.</p>
<p><strong>Inefficient: Evaluating Before the
<code>if</code></strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;let&quot;</span><span class="ot">,</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;premium_dashboard&quot;</span><span class="ot">,</span> <span class="er">&lt;...</span> <span class="er">very</span> <span class="er">expensive</span> <span class="er">expression</span> <span class="er">to</span> <span class="er">build</span> <span class="er">a</span> <span class="er">dashboard</span> <span class="er">...&gt;</span><span class="ot">],</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;basic_dashboard&quot;</span><span class="ot">,</span> <span class="er">&lt;...</span> <span class="er">another</span> <span class="er">expensive</span> <span class="er">expression</span> <span class="er">...&gt;</span><span class="ot">]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/is_premium&quot;</span><span class="ot">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/premium_dashboard&quot;</span><span class="ot">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/basic_dashboard&quot;</span><span class="ot">]</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>In this script, <strong>both</strong> the premium and basic
dashboards are fully computed and stored in variables, even though only
one will ever be used.</p>
<p><strong>Efficient: Evaluating Inside the <code>if</code></strong> By
moving the expensive expressions inside the <code>if</code> branches,
you ensure that only the necessary work is done.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/user/is_premium&quot;</span><span class="ot">],</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;...</span> <span class="er">very</span> <span class="er">expensive</span> <span class="er">expression</span> <span class="er">to</span> <span class="er">build</span> <span class="er">a</span> <span class="er">dashboard</span> <span class="er">...&gt;</span><span class="ot">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;...</span> <span class="er">another</span> <span class="er">expensive</span> <span class="er">expression</span> <span class="er">...&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This is a critical pattern for performance. <strong>Defer expensive
computations by placing them inside the branches of an <code>if</code>
statement whenever possible.</strong></p>
<h3 id="operator-performance-characteristics">Operator Performance
Characteristics</h3>
<p>Not all operators are created equal. Here is a general guide to their
relative performance cost:</p>
<ul>
<li><strong>Low Cost (Fast):</strong> <code>+</code>, <code>-</code>,
<code>*</code>, <code>/</code>, <code>==</code>, <code>&gt;</code>,
<code>get</code>, <code>$</code>, <code>obj</code>. These are typically
very fast, often mapping to single machine instructions or efficient
hash map lookups.</li>
<li><strong>Medium Cost (Depends on Data Size):</strong>
<code>merge</code>, <code>permuto.apply</code>. The cost of these
operators is proportional to the size of the objects or templates they
are processing.</li>
<li><strong>High Cost (Iterative):</strong> <code>map</code>,
<code>filter</code>, <code>reduce</code>. These are the most powerful
operators, but also the most expensive. Their cost is directly
proportional to the number of items in the array they are iterating
over. A <code>map</code> over an array with 1,000,000 items will be
1,000 times slower than a <code>map</code> over an array with 1,000
items.</li>
</ul>
<h3 id="pipeline-ordering-matters">Pipeline Ordering Matters</h3>
<p>The order of your chained array operations can have a massive impact
on performance. The key principle is to <strong>reduce the size of your
dataset as early as possible.</strong></p>
<p><strong>Anti-Pattern: <code>map</code> before
<code>filter</code></strong> Imagine you need to get the names of all
active users.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;map&quot;</span><span class="ot">,</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;filter&quot;</span><span class="ot">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;map&quot;</span><span class="ot">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/users&quot;</span><span class="ot">],</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;lambda&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;obj&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;name&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span><span class="er">...</span><span class="ot">]],</span> <span class="ot">[</span><span class="st">&quot;active&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span><span class="er">...</span><span class="ot">]]]]</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">],</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;lambda&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/u&quot;</span><span class="ot">],</span> <span class="st">&quot;/active&quot;</span><span class="ot">]]</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;lambda&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/u&quot;</span><span class="ot">],</span> <span class="st">&quot;/name&quot;</span><span class="ot">]]</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This is highly inefficient. If you have 10,000 users, the first
<code>map</code> operation will create 10,000 new, temporary objects in
memory. Then, <code>filter</code> will iterate over those 10,000 new
objects and likely discard most of them.</p>
<p><strong>Optimized Pattern: <code>filter</code> before
<code>map</code></strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;map&quot;</span><span class="ot">,</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;filter&quot;</span><span class="ot">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/users&quot;</span><span class="ot">],</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;lambda&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/u&quot;</span><span class="ot">],</span> <span class="st">&quot;/active&quot;</span><span class="ot">]]</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;lambda&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;u&quot;</span><span class="ot">],</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$&quot;</span><span class="ot">,</span> <span class="st">&quot;/u&quot;</span><span class="ot">],</span> <span class="st">&quot;/name&quot;</span><span class="ot">]]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<p>This version is dramatically better. The <code>filter</code> operator
runs first on the raw input. If only 100 users are active, the
subsequent <code>map</code> only has to do work on those 100 items. It
creates far fewer temporary objects and performs fewer iterations.</p>
<p><strong>Always filter as early as you can to reduce the amount of
data that later stages in your pipeline need to process.</strong></p>
<h3 id="tail-call-optimization-no-stack-overflow-worries">Tail Call
Optimization: No Stack Overflow Worries</h3>
<p>Computo implements tail call optimization (TCO), which means you
don’t need to worry about stack overflow errors from deeply nested
control flow structures. This makes Computo suitable for complex,
programmatically-generated transformations.</p>
<h4 id="what-this-means-for-you">What This Means for You</h4>
<p>Traditional recursive programs can cause stack overflow if they nest
too deeply. Computo eliminates this concern:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">This</span> <span class="er">would</span> <span class="er">cause</span> <span class="er">stack</span> <span class="er">overflow</span> <span class="er">in</span> <span class="er">many</span> <span class="er">languages,</span> <span class="er">but</span> <span class="er">not</span> <span class="er">in</span> <span class="er">Computo</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;count&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">]],</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;&gt;&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/score&quot;</span><span class="ot">],</span> <span class="dv">90</span><span class="ot">],</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;==&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/status&quot;</span><span class="ot">],</span> <span class="st">&quot;active&quot;</span><span class="ot">],</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="ot">[</span><span class="st">&quot;if&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;!=&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;get&quot;</span><span class="ot">,</span> <span class="ot">[</span><span class="st">&quot;$input&quot;</span><span class="ot">],</span> <span class="st">&quot;/role&quot;</span><span class="ot">],</span> <span class="st">&quot;admin&quot;</span><span class="ot">],</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Process user&quot;</span><span class="ot">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Skip admin&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="ot">],</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Inactive user&quot;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">],</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Low score&quot;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">],</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Empty input&quot;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div>
<h4 id="practical-benefits">Practical Benefits</h4>
<ol type="1">
<li><strong>Complex conditional trees</strong>: You can nest
<code>if</code> statements arbitrarily deep without performance
degradation</li>
<li><strong>Deep <code>let</code> scoping</strong>: Nested variable
scopes don’t consume stack space</li>
<li><strong>Programmatic generation</strong>: Generated scripts with
deep nesting work reliably</li>
<li><strong>No configuration needed</strong>: TCO is automatic and
always enabled</li>
</ol>
<p>This optimization makes Computo robust for complex business logic and
machine-generated transformations where nesting depth might be
unpredictable.</p>
<h3 id="in-this-chapter">In This Chapter</h3>
<p>You’ve learned the core principles of writing high-performance
Computo scripts: * Use <strong><code>let</code></strong> to avoid
re-evaluating expressions. * Leverage the <strong>lazy
evaluation</strong> of the <code>if</code> operator to defer expensive
work. * Understand the relative performance costs of different
operators. * Structure your array pipelines to
<strong><code>filter</code> early and <code>map</code> late</strong>. *
Take advantage of <strong>tail call optimization</strong> for deeply
nested control flow without stack overflow concerns.</p>
<p>By applying these principles, you can ensure that your
transformations are not only correct but also fast and efficient enough
for production workloads. The final chapters will cover error handling
and best practices to round out your expertise.</p>
</body>
</html>
